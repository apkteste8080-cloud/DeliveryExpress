<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sabor Express - Restaurante e Pizzaria</title>

  <!-- ============================
       STYLES (internos, mobile-first)
       ============================ -->
  <style>
    :root{
      --accent:#e63946;
      --lime:#bfff00;
      --card-bg: rgba(255,255,255,0.92);
      --text:#020302;
      --shadow: 14px 24px rgba(#ffffff);
    }
    /* base */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Arial, Helvetica, sans-serif;-webkit-font-smoothing:antialiased}
    body{background-image:url('https://wallpapers.com/images/featured/plano-de-fundo-de-pizza-5y42f5kd51rbps2o.jpg');background-size:cover;background-position:center;background-repeat:no-repeat;color:var(--text)}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit;cursor:pointer}

    * top banner area (clear, no watermark overlay) */
    header{display:flex;align-items:center;gap:3px;padding:12px;background:transparent}
    #top-banner{width:100%;max-width:600px;border-radius:24px;display:block;object-fit:contain;box-shadow:var(--shadow)}
    .brand-block{display:flex;flex-direction:column;gap:3px}
    #brand{font-family:"Arial Black","Arial",sans-serif;font-weight:900;font-size:36px;color:#020302;text-shadow:3px 10px rgba(#ffffff)}
    #subtitle{font-family:"Arial Black","Arial",sans-serif;font-weight:700;font-size:24px;color:#020302;text-shadow:8px 10px rgba(#ffffff)}
   #greeting{color:#020302;font-weight:1000}

    main{padding:24px}

    /* Home buttons in column, equal size */
    .home-card{background:transparent;padding-top:6px}
    .home-buttons{display:flex;flex-direction:column;gap:8px;max-width:600px}
    .main-btn{
      width:100%;
      padding:16px;
      border-radius:14px;
      border:none;
      background:var(--card-bg);
      font-weight:900;
      font-size:18px;
      color:#020302;
      box-shadow:var(--shadow);
      text-align:center;
    }

    /* screens */
    .screen{display:none}
    .screen.active{display:block}

    /* category header */
    .cat-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:8px}
    .voltar{background:transparent;border:none;color:#020302;font-weight:800;font-size:16px}

    /* list items */
    .card-list{display:flex;flex-direction:column;gap:10px}
    .card-item{background:var(--card-bg);padding:12px;border-radius:10px;display:flex;justify-content:space-between;gap:8px;box-shadow:var(--shadow)}
    .item-left{max-width:62%}
    .item-name{font-weight:900}
    .item-ingredients{font-size:13px;color:#333;margin-top:8px;max-height:120px;overflow:auto;padding-right:6px;white-space:pre-wrap}

    .item-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
    .price{font-weight:900}
    .qty-controls{display:flex;align-items:center;gap:8px}
    .qty-controls button{border:none;background:#efefef;padding:8px 10px;border-radius:8px;font-weight:900}
    .qty-num{min-width:28px;text-align:center;font-weight:900}

    /* sizes for pizzas */
    .size-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .size-option{border:1px dashed #bbb;padding:6px 8px;border-radius:8px;font-weight:800;cursor:pointer;background:#fff}
    .size-option.selected{border-color:var(--accent);box-shadow:0 6px 18px rgba(230,57,70,0.12)}

    /* conclude */
    .conclude-row{display:flex;justify-content:center;margin-top:12px}
    .conclude-btn{background:var(--lime);border:none;padding:12px 18px;border-radius:12px;font-weight:900;color:#050;border:2px solid rgba(0,0,0,0.04)}

    /* comanda (estilo C) */
    .orders{display:flex;flex-direction:column;gap:8px;margin-bottom:100px}
    .order-card{background:var(--card-bg);padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow)}
    .comanda-footer{position:fixed;left:18px;right:12px;bottom:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.95);display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow)}
    .total-value{font-size:18px;font-weight:900}

    /* payment */
    .pay-card{background:var(--card-bg);padding:12px;border-radius:10px;box-shadow:var(--shadow)}
    .pay-methods{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .pay-btn{background:var(--accent);color:#fff;padding:10px;border:none;border-radius:10px;font-weight:900}
    .pay-box{margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.95)}

    input{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px}

    /* toast */
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;z-index:120;display:none}

    /* responsive */
    @media(min-width:720px){
      header{padding:18px}
      .home-buttons{max-width:360px}
      #top-banner{max-width:480px}
    }
  </style>
</head>
<body>
  <!-- Header/banner area -->
  <header>
    <div style="display:flex;align-items:center;gap:12px;width:100%;flex-wrap:wrap">
      <img id="top-banner" src="https://i.postimg.cc/j5QhBhm3/Sabor-Express.jpg" alt="Sabor Express banner">
      <div class="brand-block">
        <div id="brand">Sabor Express</div>
        <div id="subtitle">Restaurante e Pizzaria</div>
        <div id="greeting">Faça seu pedido</div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main>
    <!-- HOME -->
    <section id="home-screen" class="screen active">
      <div class="home-card">
        <div class="home-buttons">
          <button class="main-btn" onclick="openCategory('pizzas')">PIZZAS</button>
          <button class="main-btn" onclick="openCategory('salgados')">SALGADOS</button>
          <button class="main-btn" onclick="openCategory('bebidas')">BEBIDAS</button>
          <button class="main-btn" onclick="openCategory('variados')">VARIADOS</button>
          <button class="main-btn" onclick="openComanda()">COMANDA</button>
        </div>
      </div>
    </section>

    <!-- CATEGORY -->
    <section id="category-screen" class="screen">
      <div class="cat-header">
        <button class="voltar" onclick="openHome()">← Voltar</button>
        <h2 id="category-title">Categoria</h2>
        <div></div>
      </div>

      <div id="category-list" class="card-list"></div>

      <div class="conclude-row">
        <button id="conclude-btn" class="conclude-btn" disabled onclick="concluirSelecionados()">CONCLUIR</button>
      </div>
    </section>

    <!-- COMANDA -->
    <section id="comanda-screen" class="screen">
      <div class="cat-header">
        <button class="voltar" onclick="openHome()">← Voltar</button>
        <h2>Comanda</h2>
        <div></div>
      </div>

      <div id="comanda-list" class="orders"></div>

      <div class="comanda-footer">
        <div>
          <div>Total</div>
          <div id="comanda-total" class="total-value">R$ 0,00</div>
        </div>
        <div style="min-width:160px">
          <button id="pagar-btn" class="pay-btn" onclick="iniciarPagamento()">FINALIZAR PEDIDO</button>
        </div>
      </div>
    </section>

    <!-- PAGAMENTO -->
    <section id="pagamento-screen" class="screen">
      <div class="cat-header">
        <button class="voltar" onclick="openHome()">← Voltar</button>
        <h2>Pagamento</h2>
        <div></div>
      </div>

      <div class="pay-card">
        <div>
          <label><input type="radio" name="entrega" value="entrega"> Entrega (+R$2,00)</label>
          <label style="margin-left:12px"><input type="radio" name="entrega" value="retirar" checked> Retirar</label>
        </div>

        <div id="entrega-fields" style="display:none;margin-top:10px">
          <input id="cliente-nome" placeholder="Nome do cliente (obrigatório para entrega)" />
          <input id="cliente-endereco" placeholder="Endereço (rua, número, complemento)" />
        </div>

        <div class="pay-methods">
          <button class="pay-btn" onclick="selecionarPagamento('pix')">PIX</button>
          <button class="pay-btn" onclick="selecionarPagamento('dinheiro')">DINHEIRO</button>
          <button class="pay-btn" onclick="selecionarPagamento('cartao')">CARTÃO</button>
        </div>

        <div id="pix-box" class="pay-box" style="display:none">
        <div>Chave PIX: <strong id="pix-key">pix_fake_2025@exemplo.com</strong></div>
          <div>VALOR: R$ <span id="pix-valor">0.00</span></div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="copiar-pix" class="pay-btn">Copiar Chave & Finalizar</button>
            
          </div>
        </div>

        <div id="dinheiro-box" class="pay-box" style="display:none">
          <div>Precisa de troco?</div>
          <input id="troco-valor" placeholder="Ex: Troco para R$ 50" />
        </div>

        <div style="margin-top:12px">
          <button id="finalizar-btn" class="pay-btn" disabled onclick="finalizarPedido()">FINALIZAR</button>
        </div>
      </div>
    </section>
  </main>

  <!-- toast -->
  <div id="toast">Mensagem</div>

  <!-- ============================
       SCRIPTS
       ============================ -->
  <script>
    /* CONFIGURAÇÕES */
    const numeroWhatsAppLoja = '5588996488990'; // já informado
    const PIX_KEY = 'pix_fake_2025@exemplo.com';

    /* ESTADO */
    let categoriaAtiva = null;
    let tempSelection = {}; // itemId -> { qty, size, price, meta }
    let comanda = [];

    /* MENU inicial (3 pizzas + extras) */
    const MENU = {
      pizzas: [
        { id:'p1', name:'CALABRESA', ingredients: 'Mussarela, calabresa, cebola', price:{P:20, M:25, G:30} },
        { id:'p2', name:'FRANGO CATUPIRY', ingredients: 'Frango desfiado, catupiry, milho', price:{P:22, M:28, G:34} },
        { id:'p3', name:'4 QUEIJOS', ingredients: 'Mussarela, provolone, parmesão, gorgonzola', price:{P:24, M:30, G:36} }
      ],
      salgados: [
        { id:'s1', name:'Coxinha', ingredients:'Recheio tradicional', price:{D:6} },
        { id:'s2', name:'Esfiha', ingredients:'Esfiha aberta', price:{D:5.5} }
      ],
      bebidas: [
        { id:'b1', name:'Coca 2L', ingredients:'Refrigerante', price:{D:10} },
        { id:'b2', name:'Água 500ml', ingredients:'Água mineral', price:{D:4} }
      ],
      variados: [
        { id:'v1', name:'Canja', ingredients:'Canja caseira', price:{D:12} },
        { id:'v2', name:'Sopa do dia', ingredients:'Consulte', price:{D:15} }
      ]
    };

    /* util DOM */
    const $ = id => document.getElementById(id);
    function showScreen(id){
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      $(id).classList.add('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function show(el){ if(!el) return; el.style.display = ''; }
    function hide(el){ if(!el) return; el.style.display = 'none'; }
    function toast(txt, time=1400){ const t = $('toast'); t.textContent = txt; t.style.display='block'; setTimeout(()=>t.style.display='none', time); }

    /* NAV */
    function openHome(){
      categoriaAtiva = null;
      tempSelection = {};
      renderComandaPreview();
      showScreen('home-screen');
    }

    function openCategory(cat){
      categoriaAtiva = cat;
      tempSelection = {};
      renderCategory(cat);
      showScreen('category-screen');
      $('conclude-btn').disabled = true;
      $('category-title').textContent = cat.toUpperCase();
    }

    function openComanda(){
      renderComanda();
      showScreen('comanda-screen');
    }

    function iniciarPagamento(){
      if(comanda.length === 0){ toast('Comanda vazia'); return; }
      // preparar valores
      const total = totalComanda();
      $('pix-valor').textContent = total.toFixed(2);
      $('pix-key').textContent = PIX_KEY;
      hide($('pix-box'));
      hide($('dinheiro-box'));
      $('finalizar-btn').disabled = true;
      // default retirar
      document.querySelector('input[name="entrega"][value="retirar"]').checked = true;
      hide($('entrega-fields'));
      showScreen('pagamento-screen');
    }

    /* iniciar app */
    document.addEventListener('DOMContentLoaded', ()=>{
      openHome();
      // entrega radio
      document.querySelectorAll('input[name="entrega"]').forEach(r=>{
        r.addEventListener('change', ()=> {
          const v = document.querySelector('input[name="entrega"]:checked').value;
          if(v === 'entrega') show($('entrega-fields')); else hide($('entrega-fields'));
        });
      });
      // pix copy finalize
      $('copiar-pix').addEventListener('click', copiarPixAndFinalize);
    });

    /* RENDER CATEGORY */
    function renderCategory(cat){
      const list = $('category-list'); list.innerHTML = '';
      const arr = MENU[cat] || [];
      arr.forEach(item=>{
        const card = document.createElement('div'); card.className = 'card-item';

        const left = document.createElement('div'); left.className = 'item-left';
        const name = document.createElement('div'); name.className = 'item-name'; name.textContent = item.name;
        const ingr = document.createElement('div'); ingr.className = 'item-ingredients'; ingr.textContent = item.ingredients;
        left.appendChild(name); left.appendChild(ingr);

        const right = document.createElement('div'); right.className = 'item-right';
        const price = document.createElement('div'); price.className = 'price';
        if(cat === 'pizzas'){
          const minP = Math.min(item.price.P, item.price.M, item.price.G);
          price.textContent = `desde R$ ${minP.toFixed(2)}`;
        } else {
          price.textContent = `R$ ${(item.price.D).toFixed(2)}`;
        }

        // qty controls
        const qtyControls = document.createElement('div'); qtyControls.className = 'qty-controls';
        const btnMinus = document.createElement('button'); btnMinus.textContent = '-';
        const qtyNum = document.createElement('span'); qtyNum.className = 'qty-num'; qtyNum.id = `q_${item.id}`; qtyNum.textContent = '0';
        const btnPlus = document.createElement('button'); btnPlus.textContent = '+';
        qtyControls.appendChild(btnMinus); qtyControls.appendChild(qtyNum); qtyControls.appendChild(btnPlus);

        // sizes
        let sizeRow = null;
        if(cat === 'pizzas'){
          sizeRow = document.createElement('div'); sizeRow.className = 'size-row';
          ['P','M','G'].forEach(sz=>{
            const sbtn = document.createElement('button');
            sbtn.className = 'size-option';
            sbtn.textContent = `${sz} - R$ ${item.price[sz].toFixed(2)}`;
            sbtn.onclick = ()=>{
              // visual
              Array.from(sizeRow.children).forEach(c=>c.classList.remove('selected'));
              sbtn.classList.add('selected');
              // ensure temp entry exists and set size
              if(!tempSelection[item.id]) tempSelection[item.id] = { qty:0, size:sz, price: item.price[sz], meta:item };
              else { tempSelection[item.id].size = sz; tempSelection[item.id].price = item.price[sz]; tempSelection[item.id].meta = item; }
              updateConcludeButton();
            };
            sizeRow.appendChild(sbtn);
          });
        }

        // plus/minus behavior
        btnPlus.onclick = ()=>{
          let q = Number(qtyNum.textContent||0) + 1;
          qtyNum.textContent = q;
          ensureTempEntry(item, q);
          updateConcludeButton();
        };
        btnMinus.onclick = ()=>{
          let q = Number(qtyNum.textContent||0) - 1; if(q < 0) q = 0;
          qtyNum.textContent = q;
          ensureTempEntry(item, q);
          updateConcludeButton();
        };

        right.appendChild(price); right.appendChild(qtyControls);
        if(sizeRow) right.appendChild(sizeRow);
        card.appendChild(left); card.appendChild(right);
        list.appendChild(card);
      });
      // conclude disabled until valid
      $('conclude-btn').disabled = true;
    }

    function ensureTempEntry(item, qty){
      if(qty <= 0){
        delete tempSelection[item.id];
        return;
      }
      const cat = categoriaAtiva;
      if(cat === 'pizzas'){
        // keep size required - if size missing, still set qty but not ready for conclude
        if(!tempSelection[item.id]) tempSelection[item.id] = { qty: qty, size: null, price: null, meta: item };
        else { tempSelection[item.id].qty = qty; tempSelection[item.id].meta = item; if(tempSelection[item.id].size) tempSelection[item.id].price = item.price[tempSelection[item.id].size]; }
      } else {
        tempSelection[item.id] = { qty: qty, size: null, price: item.price.D, meta: item };
      }
    }

    function updateConcludeButton(){
      const entries = Object.values(tempSelection);
      const ok = entries.some(e => e.qty > 0 && (e.meta && e.meta.price && e.meta.price.P ? (e.size) : true));
      $('conclude-btn').disabled = !ok;
    }

    /* concluir: transforma tempSelection em itens válidos e vai para comanda */
    function concluirSelecionados(){
      const entries = Object.entries(tempSelection);
      let added = 0;
      entries.forEach(([id, e])=>{
        if(!e || e.qty <= 0) return;
        if(e.meta && e.meta.price && e.meta.price.P){
          if(!e.size || !e.price) return;
          const it = { id: id + '_' + e.size, name: `${e.meta.name} (${e.size})`, qty: e.qty, unitPrice: e.price, category: categoriaAtiva };
          comanda.push(it); added++;
        } else {
          const it = { id: id, name: e.meta.name, qty: e.qty, unitPrice: e.price, category: categoriaAtiva };
          comanda.push(it); added++;
        }
      });
      if(added > 0){
        tempSelection = {};
        // reset counters visually
        document.querySelectorAll('[id^="q_"]').forEach(el => el.textContent = '0');
        showScreen('comanda-screen');
        renderComanda();
        toast(`${added} item(s) adicionados à comanda`);
      } else {
        toast('Nenhum item válido (verifique tamanhos/quantidades)');
      }
    }

    /* COMANDA render (estilo C) */
    function renderComanda(){
      const list = $('comanda-list'); list.innerHTML = '';
      if(comanda.length === 0){
        list.innerHTML = '<div class="item-ingredients">Comanda vazia. Adicione itens.</div>';
      } else {
        comanda.forEach((it, idx)=>{
          const row = document.createElement('div'); row.className = 'order-card';
          row.innerHTML = `
            <div>
              <div style="font-weight:900">${it.qty}x ${it.name}</div>
              <div class="item-ingredients">R$ ${(it.unitPrice * it.qty).toFixed(2)}</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
              <div>
                <button class="voltar" onclick="decreaseQty(${idx})">-</button>
                <button class="voltar" onclick="increaseQty(${idx})">+</button>
                <button class="voltar" onclick="removeFromComanda(${idx})" style="color:#b91d2c">Remover</button>
              </div>
              <div class="small">cat: ${it.category}</div>
            </div>
          `;
          list.appendChild(row);
        });
      }
      $('comanda-total').textContent = `R$ ${totalComanda().toFixed(2)}`;
      updateGreeting();
    }
    function increaseQty(i){ comanda[i].qty += 1; renderComanda(); }
    function decreaseQty(i){ if(comanda[i].qty>1) comanda[i].qty -=1; else removeFromComanda(i); renderComanda(); }
    function removeFromComanda(i){ comanda.splice(i,1); renderComanda(); }
    function totalComanda(){ return comanda.reduce((s,it)=>s + it.unitPrice * it.qty, 0); }

    function renderComandaPreview(){
      const itens = comanda.reduce((s,it)=>s + it.qty, 0);
      const total = totalComanda();
      $('greeting').textContent = itens > 0 ? `${itens} item(s) • R$ ${total.toFixed(2)}` : 'Faça seu pedido';
    }
    function updateGreeting(){ renderComandaPreview(); }

    /* PAGAMENTO */
    let metodoEscolhido = null;
    function selecionarPagamento(metodo){
      metodoEscolhido = metodo;
      if(metodo === 'pix'){ show($('pix-box')); hide($('dinheiro-box')); $('finalizar-btn').disabled = true; }
      if(metodo === 'dinheiro'){ show($('dinheiro-box')); hide($('pix-box')); $('finalizar-btn').disabled = false; }
      if(metodo === 'cartao'){ hide($('pix-box')); hide($('dinheiro-box')); $('finalizar-btn').disabled = false; }
    }

    function copiarPixAndFinalize(){
      navigator.clipboard.writeText(PIX_KEY).catch(()=>{});
      enviarPedido('pix');
    }
    function abrirWhatsappPix(){
      const total = totalComanda();
      const msg = `Pedido - VALOR R$ ${total.toFixed(2)} - Chave PIX: ${PIX_KEY}`;
      window.open(`https://wa.me/${numeroWhatsAppLoja}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function finalizarPedido(){
      if(!['dinheiro','cartao'].includes(metodoEscolhido)){ toast('Selecione Dinheiro ou Cartão'); return; }
      enviarPedido(metodoEscolhido);
    }

    function enviarPedido(metodo){
      const numeroPedido = nextOrderNumber();
      let total = totalComanda();
      const entregaEl = document.querySelector('input[name="entrega"]:checked');
      const entrega = entregaEl ? entregaEl.value : 'retirar';
      if(entrega === 'entrega') total += 2.00;

      let clienteNome = '';
      let endereco = '';
      if(entrega === 'entrega'){
        clienteNome = $('cliente-nome').value.trim();
        endereco = $('cliente-endereco').value.trim();
      }

      let msg = `Pedido Nº ${numeroPedido}%0A`;
      msg += `Forma: ${metodo.toUpperCase()}%0A`;
      msg += `Entrega: ${entrega.toUpperCase()}%0A`;
      if(clienteNome) msg += `Cliente: ${encodeURIComponent(clienteNome)}%0A`;
      if(endereco) msg += `End: ${encodeURIComponent(endereco)}%0A`;
      comanda.forEach(it=>{
        msg += `${it.qty}x ${it.name} - R$ ${(it.unitPrice * it.qty).toFixed(2)}%0A`;
      });
      msg += `TOTAL: R$ ${total.toFixed(2)}%0A`;
      if(metodo === 'pix') msg += `PIX - Chave: ${PIX_KEY}%0A`;
      if(metodo === 'dinheiro'){
        const troco = $('troco-valor').value.trim() || '-';
        msg += `Troco: ${encodeURIComponent(troco)}%0A`;
      }

      // open whatsapp
      window.open(`https://wa.me/${numeroWhatsAppLoja}?text=${msg}`, '_blank');

      // cleanup and return to home
      comanda = [];
      tempSelection = {};
      renderComanda();
      openHome();
      toast('Pedido enviado. Obrigado!');
    }

    /* helpers */
    function nextOrderNumber(){
      const hoje = new Date().toISOString().slice(0,10);
      const key = 'ordernum_'+hoje;
      let n = Number(localStorage.getItem(key) || 0) + 1;
      localStorage.setItem(key, n);
      return String(n).padStart(3,'0');
    }

    /* start */
    // expose some for html onclick usage
    window.openHome = openHome;
    window.openCategory = openCategory;
    window.openComanda = openComanda;
    window.iniciarPagamento = iniciarPagamento;
    window.selecionarPagamento = selecionarPagamento;
    window.copiarPixAndFinalize = copiarPixAndFinalize;
    window.abrirWhatsappPix = abrirWhatsappPix;
    window.finalizarPedido = finalizarPedido;
    window.concluirSelecionados = concluirSelecionados;
  </script>
</body>
</html>
