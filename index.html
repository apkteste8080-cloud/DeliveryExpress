<!-- substitua as seções estáticas de Pizzas/Salgados/Bebidas pela div onde o menu será renderizado -->
<section class="categoria" id="menu">
  <h2><i class="fa-solid fa-utensils"></i> Cardápio</h2>
  <div id="menu-grid" class="grid"></div>
</section>

<!-- mantenha o carrinho/opções/pagamento como estão, só vamos trocar o script -->
<script>
/* ===== CONFIGURAÇÃO ===== */
const numeroWhatsApp = '5588996488990'; // seu número com DDI+DDD
let chavePix = 'seuemail@exemplo.com'; // chave PIX — altere aqui
// Gera URL do QR (api.qrserver.com). Pode trocar pelo gerador que preferir.
function gerarQrUrl(chave) {
  const payload = `PIX:${chave}`; // texto simples; se quiser o payload do PIX COP (código EMV) gere payload específico
  return `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(payload)}&size=200x200`;
}

/* ===== CARDÁPIO =====
  Adicione/edite itens aqui. image: URL da imagem (pode ser local ou CDN)
  categoria deve ser: 'Pizzas', 'Salgados', 'Bebidas', etc.
*/
const produtos = [
  { id: 1, categoria: 'Pizzas', nome: 'Pizza Calabresa', desc: 'Queijo, calabresa, cebola e orégano.', preco: 35.00, image: 'https://images.unsplash.com/photo-1601924582971-d1010e4a5e3d' },
  { id: 2, categoria: 'Salgados', nome: 'Coxinha', desc: 'Tradicional de frango com catupiry.', preco: 6.00, image: 'https://images.unsplash.com/photo-1601050690597-3b4c1780d46a' },
  { id: 3, categoria: 'Bebidas', nome: 'Refrigerante Lata', desc: '350ml, diversos sabores.', preco: 6.00, image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b' },
  // adicione quantos quiser...
];

/* ===== ESTADO DO CARRINHO ===== */
let carrinho = {}; // { produtoId: quantidade }

/* ===== RENDER DO CARDÁPIO ===== */
function renderMenu() {
  const grid = document.getElementById('menu-grid');
  grid.innerHTML = '';

  // agrupar por categoria
  const categorias = {};
  produtos.forEach(p => {
    if (!categorias[p.categoria]) categorias[p.categoria] = [];
    categorias[p.categoria].push(p);
  });

  // para cada categoria, cria bloco
  for (const [cat, itens] of Object.entries(categorias)) {
    const catTitle = document.createElement('div');
    catTitle.className = 'categoria-block';
    catTitle.innerHTML = `<h3 style="margin-top:1rem;color:#1d3557;border-left:5px solid #e63946;padding-left:10px;">${cat}</h3>`;
    grid.appendChild(catTitle);

    const catGrid = document.createElement('div');
    catGrid.className = 'grid';
    catGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(180px, 1fr))';
    catGrid.style.gap = '1rem';

    itens.forEach(item => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${item.image}" alt="${item.nome}" onerror="this.src='https://via.placeholder.com/400x300?text=Sem+imagem'">
        <div class="card-content">
          <h3>${item.nome}</h3>
          <p>${item.desc}</p>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="price">R$ ${item.preco.toFixed(2)}</span>
            <div>
              <button onclick="adicionarAoCarrinho(${item.id})" style="margin-left:8px;padding:6px;border-radius:8px;background:#457b9d;color:#fff;border:none;cursor:pointer;">
                <i class="fa-solid fa-cart-plus"></i> Adicionar
              </button>
            </div>
          </div>
        </div>
      `;
      catGrid.appendChild(card);
    });

    grid.appendChild(catGrid);
  }
}

/* ===== FUNÇÕES DO CARRINHO ===== */
function adicionarAoCarrinho(id) {
  carrinho[id] = (carrinho[id] || 0) + 1;
  atualizarCarrinho();
}

function removerDoCarrinho(id) {
  delete carrinho[id];
  atualizarCarrinho();
}

function mudarQuantidade(id, delta) {
  if (!carrinho[id]) return;
  carrinho[id] += delta;
  if (carrinho[id] <= 0) delete carrinho[id];
  atualizarCarrinho();
}

function atualizarCarrinho() {
  const lista = document.getElementById('lista-carrinho');
  lista.innerHTML = '';
  let total = 0;

  // transforma carrinho em array com dados completos
  const linhas = Object.entries(carrinho).map(([idStr, qtd]) => {
    const id = Number(idStr);
    const produto = produtos.find(p => p.id === id);
    const subtotal = produto.preco * qtd;
    total += subtotal;

    const li = document.createElement('li');
    li.style.display = 'flex';
    li.style.justifyContent = 'space-between';
    li.style.alignItems = 'center';

    li.innerHTML = `
      <div style="flex:1">
        <strong>${produto.nome}</strong><br>
        <small>R$ ${produto.preco.toFixed(2)} x ${qtd} = R$ ${subtotal.toFixed(2)}</small>
      </div>
      <div style="display:flex;gap:6px;align-items:center">
        <button onclick="mudarQuantidade(${id}, -1)" style="padding:4px 6px;border-radius:6px;">-</button>
        <button onclick="mudarQuantidade(${id}, 1)" style="padding:4px 6px;border-radius:6px;">+</button>
        <button onclick="removerDoCarrinho(${id})" style="padding:4px 6px;border-radius:6px;color:#b91d2c;">Remover</button>
      </div>
    `;
    return li;
  });

  linhas.forEach(li => lista.appendChild(li));
  document.getElementById('total').textContent = total.toFixed(2);
}

/* ===== TOGGLERS E CONFIRMAR PEDIDO (WHATSAPP) ===== */
function toggleEndereco() {
  const tipo = document.getElementById('tipo-pedido').value;
  document.getElementById('endereco-field').style.display = tipo === 'entrega' ? 'block' : 'none';
}

function togglePagamento() {
  const metodo = document.getElementById('pagamento').value;
  document.getElementById('pix-info').style.display = metodo === 'pix' ? 'block' : 'none';
  document.getElementById('dinheiro-info').style.display = metodo === 'dinheiro' ? 'block' : 'none';
  if (metodo === 'pix') {
    // atualiza imagem do QR e a chave exibida
    document.querySelector('#pix-info strong').textContent = 'Chave PIX:';
    document.querySelector('#pix-info p').innerHTML = `<strong>Chave PIX:</strong> ${chavePix}`;
    document.querySelector('#pix-info img').src = gerarQrUrl(chavePix);
  }
}

function confirmarPedido() {
  if (Object.keys(carrinho).length === 0) {
    alert('Adicione pelo menos um item ao pedido.');
    return;
  }
  const tipo = document.getElementById('tipo-pedido').value;
  const pagamento = document.getElementById('pagamento').value;
  const endereco = tipo === 'entrega' ? document.getElementById('endereco').value || '-' : 'Retirada no local';
  const troco = pagamento === 'dinheiro' ? document.getElementById('troco').value : '';

  let resumo = `*Novo Pedido*%0A`;
  Object.entries(carrinho).forEach(([id, qtd]) => {
    const p = produtos.find(x => x.id === Number(id));
    resumo += `- ${p.nome} (x${qtd}): R$ ${(p.preco * qtd).toFixed(2)}%0A`;
  });
  resumo += `%0ATotal: R$ ${document.getElementById('total').textContent}`;
  resumo += `%0ATipo: ${tipo.toUpperCase()}%0AEndereço: ${encodeURIComponent(endereco)}`;
  resumo += `%0APagamento: ${pagamento.toUpperCase()}`;
  if (troco) resumo += `%0ATroco: ${encodeURIComponent(troco)}`;
  resumo += `%0A%0A⚠️ *Importante:* Envie o comprovante de pagamento via WhatsApp para confirmar o pedido.`;

  const url = `https://wa.me/${numeroWhatsApp}?text=${resumo}`;
  window.open(url, '_blank');
}

/* ===== INICIALIZAÇÃO ===== */
document.addEventListener('DOMContentLoaded', () => {
  renderMenu();
  atualizarCarrinho();

  // configura primeira renderização do PIX info
  document.getElementById('pix-info').innerHTML = `
    <p><strong>Chave PIX:</strong> ${chavePix}</p>
    <p>Envie o comprovante do pagamento via WhatsApp para confirmar o pedido.</p>
    <img src="${gerarQrUrl(chavePix)}" alt="QR Code PIX">
  `;
});
</script>
